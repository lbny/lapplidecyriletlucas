# lapplidecyriletlucas

MainActivity :

Normalement l'activité principale supporte le drawer sur la gauche quand on est au niveau de l'accueil et affiche une flèche quand on passe à un nouveau fragment.
Pour faire simple dans le onCreate on autorise l'ActionBar à afficher le bouton home et la navigation avec le cas échéant, ensuite on déclare un ActionBarDrawerToggle qui est un grosso modo un listener qui écoute l'ouverture et la fermeture du drawer (il se contente de modifier le titre dans l'ActionBar). On récupère ensuite la listView contenu dans le drawer et qui va servir à afficher les noms des différents fragments auxquels on va pouvoir accéder : pour lancer les fragments modifier selectItem().
Autre méthode importante : changeFragment() qui est appelé pour changer le fragment affiché par l'activité.
Pour comprendre un peu les histoires de la flèche et du bouton "home" (qui permet d'afficher le drawer), d'après ce que j'ai compris une activité maintient en permanance une sorte de "pile" de fragment qui sont en gros tous les fragments qui ont été créés depuis l'écran d'accueil (la racine quoi si tu voies la navigation comme un arbre et qu'afficher un nouveau fragment revient à passer à un noeud fils et appuyer sur la flèche revient à remonter au parent). Et quand tu reviens en arrière avec la flèche ça supprime le fragment qui était affiché avant e tu appuies de la pile et donc du coup quand tu arrives à l'accueil t'as supprimé tous les fragments que t'avais créés et la pile est vide (ils appelent ça BackStack sur android).
Et donc en fait la MainActivity elle implémente une interface qui écoute les changements du BackStack donc chaque fois que tu créées un nouveau fragment ou que tu reviens en arrière ça appelle onBackStackChanged() qui va checker si on doit afficher le bouton home ou la flèche en haut à gauche. Et grâce à cette interface t'as également une méthode qui correspond au clic sur la flèche (quand elle est affichée) : onSupportUpNavigation() et dedans popBackStack() ça sert simplement à afficher le fragment précédent à la place du fragment actuel.
Dans shouldDisplayHomeUp() t'as aussi un test sur la BackStack avec getBackStackEntryCount qui retourne le nombre de fragments dans la stack. Du coup dans shouldDisplayHomeUp() on check le nombre de fragments dans la stack s'il n'y en a plus on affiche le bouton pour ouvrir le drawer (home) et sinon on affiche la flèche.
